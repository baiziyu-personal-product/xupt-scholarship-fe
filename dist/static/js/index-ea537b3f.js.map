{"version":3,"file":"index-ea537b3f.js","sources":["../../../src/pages/process/pages/handle-process/components/process-step-info/index.tsx"],"sourcesContent":["import { Avatar, Card, Descriptions, DescriptionsProps, Empty, message, Tag, Tooltip } from 'antd';\r\nimport * as React from 'react';\r\nimport * as api from '@/service/process';\r\nimport { ProcessStep, CurrentDate, ProcessList } from '../../process.list';\r\nimport style from '../../style.module.less';\r\nimport { useProcess } from '@/context/process-status';\r\nimport { useAuth } from '@/context/auth.context';\r\nimport { useUserListContext } from '@/context/user-list';\r\n\r\ninterface IProps extends DescriptionsProps {\r\n  title: string;\r\n}\r\n\r\nexport interface ProcessInfo {\r\n  responsible_department: string[];\r\n  title: string;\r\n  step: ProcessStep;\r\n  date: [string, string];\r\n  manager: {\r\n    name: string;\r\n    email: string;\r\n    avatar: string;\r\n  }[];\r\n  processingRatio: string;\r\n  dailyProcessingRate: number;\r\n  desc: string[];\r\n}\r\n\r\nconst defaultProcessInfoList: ProcessInfo[] = [\r\n  {\r\n    responsible_department: [],\r\n    title: '尚未开始',\r\n    step: 'deployment_mobilization_phase',\r\n    date: CurrentDate,\r\n    manager: [{\r\n      name: '-',\r\n      email: '-',\r\n      avatar: '-',\r\n    }],\r\n    processingRatio: '0/0',\r\n    dailyProcessingRate: 0,\r\n    desc: [],\r\n  }\r\n]\r\n\r\nconst ProcessStepInfo: React.FC<IProps> = (props) => {\r\n  const { title, ...resetProps } = props;\r\n  const { list } = useUserListContext();\r\n  const { process_id, step } = useProcess();\r\n  const [processInfoList, setProcessInfoList] = React.useState<ProcessInfo[]>(defaultProcessInfoList);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const getUserInfo = (email: string) => {\r\n    return list.find(item => item.email === email) || {};\r\n  }\r\n  const getProcessInfo = (step: string) => (ProcessList.find(item => item.step === step) || {} as any);\r\n\r\n  const getProcess = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { form } = await api.getProcessData(process_id);\r\n      const initValue = form.form.filter((v) => v.step === step).map(v => {\r\n        const info = getProcessInfo(v.step);\r\n        return {\r\n          ...info,\r\n          ...v,\r\n          desc: [v.desc, info?.desc || ''].filter(v => !!v),\r\n          manager: v.mentions?.map(t => getUserInfo(t))\r\n        }\r\n      }) as ProcessInfo[];\r\n      setProcessInfoList(initValue);\r\n    } catch (error) {\r\n      message.error(error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    getProcess();\r\n  }, [process_id, step]);\r\n\r\n  return (\r\n    <Card\r\n      className={style['process-step-card']}\r\n      loading={loading}\r\n      title={\r\n        <div\r\n          className={style['card-box-title']}\r\n        >{\r\n            !!processInfoList.length ? \"当前处理流程\" : null\r\n          }</div>\r\n      }\r\n    >\r\n      {\r\n        !processInfoList.length\r\n          ? <Empty />\r\n          : processInfoList.map(info => (\r\n            <Descriptions\r\n              key={info.step}\r\n              title={\r\n                <div\r\n                  className={style['card-title']}\r\n                >{title}</div>\r\n              }\r\n              bordered\r\n              {...resetProps}\r\n            >\r\n              <Descriptions.Item label=\"当前流程\">{info.title}</Descriptions.Item>\r\n              <Descriptions.Item label=\"开始时间\">{info.date[0]}</Descriptions.Item>\r\n              <Descriptions.Item label=\"预期处理截至时间\">{info.date[1]}</Descriptions.Item>\r\n              <Descriptions.Item label=\"处理人\">\r\n                <Avatar.Group>\r\n                  {info.manager.map(m => (\r\n                    <Tooltip key={m.email} title={`${m.name} | ${m.email}`} placement=\"top\">\r\n                      <Avatar src={m.avatar} />\r\n                    </Tooltip>\r\n                  ))}\r\n                </Avatar.Group>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"主体成员\">{\r\n                info.responsible_department.map(item => (\r\n                  <Tag key={item} color=\"geekblue\">{item}</Tag>\r\n                ))\r\n              }</Descriptions.Item>\r\n              <Descriptions.Item label=\"流程描述\">\r\n                {\r\n                  info.desc.map(item => (\r\n                    <span key={item}>{item}</span>\r\n                  ))\r\n                }\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          ))\r\n      }\r\n    </Card>\r\n  );\r\n};\r\n\r\nProcessStepInfo.defaultProps = {\r\n}\r\n\r\nexport default ProcessStepInfo;"],"names":["React.useState","api.getProcessData"],"mappings":"m0BA4BA,KAAM,GAAwC,CAC5C,CACE,uBAAwB,GACxB,MAAO,2BACP,KAAM,gCACN,KAAM,EACN,QAAS,CAAC,CACR,KAAM,IACN,MAAO,IACP,OAAQ,MAEV,gBAAiB,MACjB,oBAAqB,EACrB,KAAM,KAIJ,EAAoC,AAAC,GAAU,MAClB,KAAzB,UAAyB,EAAf,IAAe,EAAf,CAAV,UACF,CAAE,QAAS,IACX,CAAE,aAAY,QAAS,IACvB,CAAC,EAAiB,GAAsBA,mBAA8B,GACtE,CAAC,EAAS,GAAcA,mBAAe,IACvC,EAAc,AAAC,GACZ,EAAK,KAAK,GAAQ,EAAK,QAAU,IAAU,GAE9C,EAAiB,AAAC,GAAkB,EAAY,KAAK,GAAQ,EAAK,OAAS,IAAS,GAEpF,EAAa,SAAY,IACzB,GACS,SACL,CAAE,QAAS,KAAMC,GAAmB,GACpC,EAAY,EAAK,KAAK,OAAO,AAAC,GAAM,EAAE,OAAS,GAAM,IAAI,GAAK,YAC5D,GAAO,EAAe,EAAE,YACvB,UACF,GACA,GAFE,CAGL,KAAM,CAAC,EAAE,KAAM,kBAAM,OAAQ,IAAI,OAAO,GAAK,CAAC,CAAC,GAC/C,QAAS,KAAE,WAAF,cAAY,IAAI,GAAK,EAAY,UAG3B,SACZ,KACC,MAAM,EAAM,mBAET,iCAIC,IAAM,MAEnB,CAAC,EAAY,4BAGb,EAAD,CACE,UAAW,EAAM,qBACjB,UACA,8BACG,MAAD,CACE,UAAW,EAAM,mBAEf,AAAE,EAAgB,OAAS,uCAAW,OAK1C,AAAC,EAAgB,OAEb,EAAgB,IAAI,2BACnB,EAAD,GACE,IAAK,EAAK,KACV,8BACG,MAAD,CACE,UAAW,EAAM,eACjB,GAEJ,SAAQ,IACJ,2BAEH,EAAa,KAAd,CAAmB,MAAM,4BAAQ,EAAK,+BACrC,EAAa,KAAd,CAAmB,MAAM,4BAAQ,EAAK,KAAK,4BAC1C,EAAa,KAAd,CAAmB,MAAM,oDAAY,EAAK,KAAK,4BAC9C,EAAa,KAAd,CAAmB,MAAM,8CACtB,EAAO,MAAR,KACG,EAAK,QAAQ,IAAI,2BACf,EAAD,CAAS,IAAK,EAAE,MAAO,MAAO,GAAG,EAAE,UAAU,EAAE,QAAS,UAAU,+BAC/D,EAAD,CAAQ,IAAK,EAAE,qCAKtB,EAAa,KAAd,CAAmB,MAAM,4BACvB,EAAK,uBAAuB,IAAI,2BAC7B,EAAD,CAAK,IAAK,EAAM,MAAM,YAAY,6BAGrC,EAAa,KAAd,CAAmB,MAAM,4BAErB,EAAK,KAAK,IAAI,2BACX,OAAD,CAAM,IAAK,GAAO,+BAhCzB,EAAD,QA2CZ,EAAgB,aAAe"}