import{r as e,am as T,F as m,e as C,a9 as I,an as V,I as f,m as x,u as k,J as E,ao as y,ap as b,T as L,ab as R,aq as q,C as S}from"./vendor-d77eef1c.js";import{H as P,u as j}from"./index-2bf6b87e.js";import{c as h,r as z,u as U,k as $,l as K,s as M,A as O,E as X}from"./index-89cb7035.js";function v(a){var s=e.exports.useRef(a);return s.current=a,s}var Z=function(s){var t=v(s);e.exports.useEffect(function(){return function(){t.current()}},[])},J=Z,W=globalThis&&globalThis.__read||function(a,s){var t=typeof Symbol=="function"&&a[Symbol.iterator];if(!t)return a;var r=t.call(a),o,l=[],n;try{for(;(s===void 0||s-- >0)&&!(o=r.next()).done;)l.push(o.value)}catch(c){n={error:c}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(n)throw n.error}}return l},G=globalThis&&globalThis.__spread||function(){for(var a=[],s=0;s<arguments.length;s++)a=a.concat(W(arguments[s]));return a};function Q(a,s){var t,r=v(a),o=(t=s==null?void 0:s.wait)!==null&&t!==void 0?t:1e3,l=e.exports.useMemo(function(){return T(function(){for(var n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];return r.current.apply(r,G(n))},o,s)},[]);return J(function(){l.cancel()}),{run:l,cancel:l.cancel,flush:l.flush}}const Y=async()=>h.get("/captcha"),ee=a=>h.post("/captcha/verify",a),te="xupt_sHsstyle-module__sign__1bU3H";var u={sign:te,"sign-left-box":"xupt_sHsstyle-module__sign-left-box__1PVbz","sign-box-mask":"xupt_sHsstyle-module__sign-box-mask__usXdy","sign-title-box":"xupt_sHsstyle-module__sign-title-box__12Du8","sign-info-box":"xupt_sHsstyle-module__sign-info-box__2zK_V","sign-info-detail":"xupt_sHsstyle-module__sign-info-detail__2Svr2","sign-info-desc":"xupt_sHsstyle-module__sign-info-desc__1HHdu","sign-info-footer":"xupt_sHsstyle-module__sign-info-footer__2WVIq","sign-form-page":"xupt_sHsstyle-module__sign-form-page__21L17","sign-form-header":"xupt_sHsstyle-module__sign-form-header__2EmWK","sign-tab-card":"xupt_sHsstyle-module__sign-tab-card__3XtFp","sign-form-item":"xupt_sHsstyle-module__sign-form-item__2_6nv","forget-password-label":"xupt_sHsstyle-module__forget-password-label__1B67t","forget-password":"xupt_sHsstyle-module__forget-password__eIwKs","forget-icon":"xupt_sHsstyle-module__forget-icon__3vsja"},d={"captcha-form":"xupt_sHsstyle-module__captcha-form__nZ9lL","captcha-box":"xupt_sHsstyle-module__captcha-box__1z4j8","captcha-reload-btn":"xupt_sHsstyle-module__captcha-reload-btn__MmCEN","captcha-img":"xupt_sHsstyle-module__captcha-img__2w25A","captcha-code-input":"xupt_sHsstyle-module__captcha-code-input__8JcBQ"};const ue=a=>{const{form:s,captchaCode:t,setCaptchaCode:r}=a,[o,l]=e.exports.useState(!1),n=async()=>{try{l(!0);const c=await Y();r(c)}catch{r(void 0),x.error("\u83B7\u53D6\u9A8C\u8BC1\u7801\u56FE\u7247\u5931\u8D25")}finally{l(!1)}};return e.exports.useEffect(()=>{n()},[]),e.exports.createElement(m,{form:s,className:d["captcha-form"]},e.exports.createElement("div",{className:d["captcha-box"]},e.exports.createElement("div",{className:d["captcha-img"]},e.exports.createElement("img",{src:`http://127.0.0.1:8096/captcha/${t}-${Date.now()}.png`,alt:"\u9A8C\u8BC1\u7801"})),e.exports.createElement(C,{loading:o,size:"large",className:d["captcha-reload-btn"],onClick:n,icon:o?e.exports.createElement(I,null):e.exports.createElement(V,null)},"\u6362\u4E00\u5F20")),e.exports.createElement(m.Item,{className:d["captcha-code-input"],name:"verify_code",rules:z},e.exports.createElement(f,{placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"})))},se={email:"",password:""},ae={email:"",password:"",confirm_password:"",identity:"student"},A=a=>{var B,F;const s=k(),{type:t,setLoading:r}=a,[o,l]=e.exports.useState(void 0),[n]=m.useForm(),[c]=m.useForm(),{signIn:w}=U(),D=((F=(B=s.state)==null?void 0:B.from)==null?void 0:F.pathname)||"/",{run:N}=Q(async()=>{await n.validateFields();try{const i=c.getFieldsValue(!0);if(!await ee({code:o||"",input_code:i.verify_code}))throw new Error("\u9A8C\u8BC1\u7801\u9519\u8BEF");const p=n.getFieldsValue(!0);r(!0);let _=null;t==="login"?_=await $(p):_=await K(p),M.setStg(O,_,X),await w(D),x.success("\u767B\u5F55\u6210\u529F")}catch(i){x.error((i==null?void 0:i.message)||"\u767B\u9646\u5931\u8D25")}finally{r(!1)}},{wait:500}),g=e.exports.useMemo(()=>t==="login"?{submitText:"\u767B\u5F55",initValue:se}:{submitText:"\u6CE8\u518C",initValue:ae},[t]);return e.exports.useEffect(()=>()=>r(!1),[]),e.exports.useEffect(()=>{n.setFieldsValue(g.initValue)},[t]),e.exports.createElement(e.exports.Fragment,null,e.exports.createElement("div",{className:u["sign-form"]},e.exports.createElement(m,{form:n,requiredMark:!1,initialValues:g.initValue,layout:"vertical"},t==="register"&&e.exports.createElement(m.Item,{className:u["sign-form-item"],name:"identity",label:"\u8EAB\u4EFD\u9009\u62E9",required:!0,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u7684\u8EAB\u4EFD\u4FE1\u606F"}],tooltip:"\u5B66\u751F\u7BA1\u7406\u4EBA\u5458\u5373\u53C2\u4E0E\u7533\u8BF7\u5956\u5B66\u91D1\u7684\u540C\u65F6\u8FD8\u8EAB\u4E3A\u5956\u5B66\u91D1\u90E8\u5206\u6D41\u7A0B\u7684\u8BC4\u5B9A\u7BA1\u7406\u4EBA\u5458"},e.exports.createElement(E.Group,{value:g},e.exports.createElement(E.Button,{value:"student"},"\u5B66\u751F"),e.exports.createElement(E.Button,{value:"manager"},"\u7BA1\u7406\u4EBA\u5458"),e.exports.createElement(E.Button,{value:"student,manager"},"\u5B66\u751F\u7BA1\u7406\u4EBA\u5458"))),e.exports.createElement(m.Item,{className:u["sign-form-item"],label:"\u90AE\u7BB1",name:"email",required:!0,hasFeedback:!0,rules:[{type:"email",required:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u683C\u5F0F"}]},e.exports.createElement(f,{placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u90AE\u7BB1"})),e.exports.createElement(m.Item,{className:u["sign-form-item"],label:"\u5BC6\u7801",name:"password",hasFeedback:!0,required:!0,rules:[{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,required:!0,message:t==="login"?"\u5BC6\u7801\u957F\u5EA6\u9700\u4E3A8-16\u4F4D\uFF0C\u5927\u5199\u5B57\u6BCD\u3001\u5C0F\u5199\u5B57\u6BCD\u4EE5\u53CA\u6570\u5B57\u7EC4\u6210":"\u5BC6\u7801\u7531\u5927\u5199\u5B57\u6BCD\u3001\u5C0F\u5199\u5B57\u6BCD\u4EE5\u53CA\u6570\u5B57\u7EC4\u6210"}]},e.exports.createElement(f.Password,{placeholder:"\u8BF7\u8F93\u5165\u60A8\u7684\u5BC6\u7801",iconRender:i=>i?e.exports.createElement(y,null):e.exports.createElement(b,null)})),t==="register"&&e.exports.createElement(m.Item,{className:u["sign-form-item"],name:"confirm_password",label:"\u786E\u8BA4\u5BC6\u7801",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01\uFF01\uFF01"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/,message:"\u5BC6\u7801\u4E3A\u516B\u4F4D\u4EE5\u4E0A\u5927\u5C0F\u5199\u5B57\u6BCD\u548C\u6570\u5B57\u7684\u7EC4\u5408"},({getFieldValue:i})=>({validator(H,p){return!p||i("password")===p?Promise.resolve():Promise.reject(new Error("\u786E\u8BA4\u5BC6\u7801\u548C\u5BC6\u7801\u4E0D\u4E00\u81F4\uFF01"))}})],required:!0},e.exports.createElement(f.Password,{placeholder:"\u8BF7\u518D\u6B21\u8F93\u5165\u60A8\u7684\u5BC6\u7801",iconRender:i=>i?e.exports.createElement(y,null):e.exports.createElement(b,null)})),e.exports.createElement(ue,{form:c,captchaCode:o,setCaptchaCode:l}),t==="login"&&e.exports.createElement(m.Item,{className:u["sign-form-item"]},e.exports.createElement("div",{className:u["forget-password-label"]},e.exports.createElement(L.Text,{type:"secondary"},"\u521D\u59CB\u5BC6\u7801\uFF1AJxj + \u5B66\u53F7"),e.exports.createElement(R,{className:u["forget-password"],to:"/forget-password"},e.exports.createElement(q,{className:u["forget-icon"]}),"\u5FD8\u8BB0\u5BC6\u7801"))),e.exports.createElement(m.Item,null,e.exports.createElement(C,{className:u["sign-submit-btn"],onClick:N,block:!0,type:"primary"},g.submitText)))))};A.defaultProps={type:"login"};const re=()=>e.exports.createElement(e.exports.Fragment,null,e.exports.createElement("section",{className:u["sign-left-box"]},e.exports.createElement("div",{className:u["sign-box-mask"]},e.exports.createElement("div",{className:u["sign-title-box"]},e.exports.createElement(P,null)),e.exports.createElement("p",{className:u["sign-info-box"]},e.exports.createElement("span",{className:u["sign-info-detail"]},"\u8FFD\u8D76\u65F6\u4EE3"),e.exports.createElement("span",{className:u["sign-info-detail"]},"\u5F00\u521B\u672A\u6765"),e.exports.createElement("span",{className:u["sign-info-detail"]},"\u670D\u52A1\u5E08\u751F")),e.exports.createElement("p",{className:u["sign-info-desc"]},"\u5956\u5B66\u91D1\u7533\u8BF7 / \u8BC4\u5B9A\u6D41\u7A0B\u7BA1\u7406"),e.exports.createElement("p",{className:u["sign-info-footer"]},"\u7248\u6743\u6240\u6709\xA9 Copyright 2022 \u897F\u5B89\u90AE\u7535\u5927\u5B66")))),oe=[{key:"login",tab:"\u767B\u5F55"},{key:"register",tab:"\u6CE8\u518C"}],ie=()=>{const[a,s]=e.exports.useState(!1),[t,r]=e.exports.useState("login");return j(t==="login"?"\u767B\u5F55":"\u6CE8\u518C",[t]),e.exports.createElement("div",{className:u.sign},e.exports.createElement(re,null),e.exports.createElement("div",{className:u["sign-form-page"]},e.exports.createElement("div",{className:u["sign-form-header"]},e.exports.createElement("div",null," Welcome~ "),e.exports.createElement("p",null,"Xi'an University of Posts and Telecommunications Graduate Scholarship Evaluation System.")),e.exports.createElement(S,{hoverable:!0,className:u["sign-tab-card"],loading:a,tabList:oe,activeTabKey:t,tabProps:{centered:!0},onTabChange:o=>r(o)},e.exports.createElement(A,{type:t,setLoading:s}))))};export{ie as default};
//# sourceMappingURL=index-db2544df.js.map
