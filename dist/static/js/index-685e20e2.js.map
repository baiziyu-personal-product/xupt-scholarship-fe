{"version":3,"file":"index-685e20e2.js","sources":["../../../src/components/page-nav/index.tsx","../../../src/components/footer/index.tsx","../../../src/components/update-user-info/index.tsx","../../../src/pages/page-layout/page-header.tsx","../../../src/pages/page-layout/index.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { getMenus, getMatchedKeys, renderMenu, getTitle } from './menu.config';\r\nimport { Layout, Menu, MenuProps } from 'antd';\r\nimport { useLocation } from 'react-router-dom';\r\nimport * as hooks from '@/hooks'\r\nimport style from './style.module.less';\r\nimport { useAuth } from '@/context/auth.context';\r\nimport { useProcess } from '@/context/process-status';\r\n\r\n\r\ninterface IProps {\r\n  updateCrumbTitle: React.Dispatch<React.SetStateAction<string[]>>;\r\n}\r\n\r\nconst PageNav: React.FC<IProps> = (props) => {\r\n  const { updateCrumbTitle } = props;\r\n  const { pathname } = useLocation();\r\n  const { user } = useAuth();\r\n  const { process_id } = useProcess();\r\n  const menus = React.useMemo(() => getMenus(process_id), [process_id]);\r\n  const matchKeys = React.useMemo(() => getMatchedKeys(pathname, menus), [menus, pathname]);\r\n  const [selectKeys, setSelectedKeys] = React.useState<string[]>(!!matchKeys.length ? matchKeys : ['home']);\r\n  const titleList = React.useMemo(() => getTitle(selectKeys, menus), [menus, selectKeys,]);\r\n  hooks.useDocumentTitle(titleList.join('-'), [titleList]);\r\n  const NavMenu = React.useMemo(() => renderMenu(menus, user.identity), [menus, user.identity]);\r\n\r\n  const updateKeys: MenuProps['onClick'] = (e) => {\r\n    setSelectedKeys(e.keyPath)\r\n  }\r\n  // 避免初始化进入导致的页面导航不匹配\r\n  React.useEffect(() => {\r\n    if (matchKeys && matchKeys.join('/') !== selectKeys.join('/')) {\r\n      setSelectedKeys([...matchKeys]);\r\n    }\r\n  }, [matchKeys]);\r\n\r\n  React.useEffect(() => {\r\n    updateCrumbTitle(titleList);\r\n  }, [titleList]);\r\n\r\n  return (\r\n    <Layout.Sider\r\n      collapsible\r\n      theme=\"light\"\r\n      breakpoint=\"lg\"\r\n      className={style['sider-nav']}\r\n    >\r\n      <Menu\r\n        mode=\"inline\"\r\n        selectedKeys={selectKeys}\r\n        onClick={updateKeys}\r\n        theme=\"light\"\r\n        className={style['page-menu']}\r\n      >\r\n        {\r\n          NavMenu\r\n        }\r\n      </Menu>\r\n    </Layout.Sider>\r\n  )\r\n};\r\n\r\nexport default React.memo(PageNav);","import * as React from 'react';\r\nimport { Layout } from 'antd';\r\n\r\nimport style from \"./index.module.less\";\r\n\r\nconst Footer: React.FC = () => {\r\n  return (\r\n    <Layout.Footer\r\n      className={style['footer']}\r\n    >\r\n      版权所有© Copyright 2022 西安邮电大学 Xi'an University of Posts&Telecommunications\r\n    </Layout.Footer>\r\n  )\r\n};\r\n\r\nexport default Footer;","import { Button, Form, Input, message, Upload } from 'antd';\nimport { validateMessages } from '@/config/form';\nimport * as React from 'react';\nimport { LoadingOutlined, UserOutlined } from '@ant-design/icons';\nimport style from './style.module.less';\nimport * as uploadApi from '@/service/upload';\nimport * as userApi from '@/service/user';\n\nexport interface CompleteUserInfoValue {\n  avatar: string;\n  name: string;\n  phone: string;\n  user_id: string;\n}\n\n\ninterface IProps {\n  formValue: CompleteUserInfoValue;\n}\n\nconst UploadUserInfo: React.FC<IProps> = (props) => {\n  const { formValue } = props;\n  const [form] = Form.useForm();\n  const [imgUrl, setImgUrl] = React.useState(formValue.avatar);\n  const [loading, setLoading] = React.useState(false);\n  const [file, setFile] = React.useState<any>(null);\n  const uploadAvatarImg = async () => {\n    if (!file) return;\n    try {\n      setLoading(true);\n      const url = await uploadApi.postAvatar(file);\n      setImgUrl(`http://127.0.0.1:8096${url}`)\n      message.success(\"上传成功\");\n    } catch (error) {\n      message.error(\"上传失败\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const updateUserInfo = async () => {\n    try {\n      setLoading(true);\n      const value = await form.validateFields();\n      await userApi.postUpdateUserInfo({\n        avatar: imgUrl,\n        ...value\n      });\n      message.success(\"完善个人信成功\");\n      location.reload();\n    } catch (error) {\n      message.error(\"完善个人信息失败\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  React.useMemo(() => {\n    uploadAvatarImg();\n  }, [file]);\n\n  const uploadButton = (\n    <div>\n      {loading ? <LoadingOutlined /> : <UserOutlined />}\n      <div className={style['upload-avatar-text']}>上传头像</div>\n    </div>\n  );\n\n  return (\n    <Form\n      form={form}\n      validateMessages={validateMessages}\n      labelAlign=\"left\"\n      {\n      ...{\n        labelCol: { span: 6, offset: 2 },\n        wrapperCol: { span: 12 },\n      }\n      }\n    >\n      <Upload\n        listType=\"picture-card\"\n        showUploadList={false}\n        className={style['upload-avatar-box']}\n        maxCount={1}\n        beforeUpload={(file) => {\n          setFile(file);\n          return false;\n        }}\n      >\n        {imgUrl ? <img src={imgUrl} alt=\"avatar\" style={{ width: '100%' }} /> : uploadButton}\n      </Upload>\n      <Form.Item\n        name=\"name\"\n        label=\"姓名\"\n      >\n        <Input placeholder=\"请输入你的姓名\" />\n      </Form.Item>\n      <Form.Item\n        name=\"phone\"\n        label=\"手机号\"\n      >\n        <Input type=\"tel\" placeholder=\"请填写你的常用手机号\" />\n      </Form.Item>\n      <Form.Item\n        name=\"user_id\"\n        label=\"学号/工号\"\n      >\n        <Input placeholder=\"请输入您的学号/工号\" />\n      </Form.Item>\n      <Button\n        type=\"primary\"\n        block\n        loading={loading}\n        disabled={loading}\n        onClick={updateUserInfo}\n        className={style['submit-btn']}\n      >更新个人信息</Button>\n    </Form >\n  );\n};\n\nUploadUserInfo.defaultProps = {\n  formValue: {\n    avatar: '',\n    name: '',\n    phone: '',\n    user_id: '',\n  }\n}\n\nexport default React.memo(UploadUserInfo);","import { usePageHeaderContext } from '@/context/page-header';\r\nimport { Breadcrumb, PageHeader } from 'antd';\r\nimport style from './style.module.less';\r\nimport * as React from 'react';\r\nimport { cx } from '@/utils';\r\n\r\ninterface IProps {\r\n  crumbTitle: string[];\r\n}\r\n\r\nconst AuthPageHeader: React.FC<IProps> = (props) => {\r\n  const { crumbTitle } = props;\r\n  const { children, ...resetProps } = usePageHeaderContext();\r\n  return (\r\n    <PageHeader\r\n      className={\r\n        cx(\r\n          style['page-header'],\r\n          children ? '' : style['sticky-header']\r\n        )\r\n      }\r\n      breadcrumbRender={() => (\r\n        <Breadcrumb>\r\n          {\r\n            crumbTitle.map(item => (\r\n              <Breadcrumb.Item key={item}>{item}</Breadcrumb.Item>\r\n            ))\r\n          }\r\n        </Breadcrumb>\r\n      )}\r\n      {...resetProps}\r\n    >{children}</PageHeader>\r\n  );\r\n};\r\n\r\nexport default AuthPageHeader;","import * as React from 'react';\r\nimport { Outlet } from 'react-router-dom';\r\nimport { Layout, Modal } from 'antd';\r\nimport PageNav from '@/components/page-nav';\r\nimport Footer from '@/components/footer';\r\nimport Header from '@/components/header';\r\nimport UpdateUserInfo from '@/components/update-user-info';\r\nimport { PageHeaderProvider } from '@/context/page-header';\r\nimport PageHeader from './page-header';\r\nimport style from './style.module.less'\r\nimport { UserListProvider } from '@/context/user-list';\r\nimport { useAuth } from '@/context/auth.context';\r\n\r\nconst PageLayout = () => {\r\n  const [crumbTitle, setCrumbTitle] = React.useState<string[]>([]);\r\n  const { user } = useAuth();\r\n  return (\r\n    <Layout className=\"base-layout\">\r\n      <Header />\r\n      <Modal\r\n        footer={null}\r\n        title=\"完善用户信息\"\r\n        visible={!user.name}>\r\n        <UpdateUserInfo\r\n          formValue={user}\r\n        />\r\n      </Modal>\r\n      <Layout className=\"site-layout\">\r\n        <PageNav\r\n          updateCrumbTitle={setCrumbTitle}\r\n        />\r\n        <Layout>\r\n          <Layout.Content\r\n            className=\"layout-content\"\r\n          >\r\n            <PageHeaderProvider>\r\n              <UserListProvider>\r\n                  <PageHeader\r\n                    crumbTitle={crumbTitle}\r\n                  />\r\n                  <div className={style['main-content-box']}>\r\n                    <Outlet />\r\n                  </div>\r\n              </UserListProvider>\r\n            </PageHeaderProvider>\r\n          </Layout.Content>\r\n          <Footer />\r\n        </Layout>\r\n      </Layout>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default PageLayout;\r\n"],"names":["React.useMemo","React.useState","style","React.memo","uploadApi.postAvatar","userApi.postUpdateUserInfo","PageNav","PageHeader"],"mappings":"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"}