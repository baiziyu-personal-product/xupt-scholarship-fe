{"version":3,"file":"index-2ac29698.js","sources":["../../../src/pages/process/pages/handle-process/process.list.ts","../../../src/pages/process/pages/handle-process/components/apply-process-steps/index.tsx"],"sourcesContent":["import moment from \"moment\";\r\n\r\n/**\r\n * 渲染位置\r\n */\r\nconst getPosition = (step: number) => {\r\n  const space = 200;\r\n  if (step === 8) {\r\n    return {\r\n      x: 50 + (step - 1) * space,\r\n      y: 400\r\n    }\r\n  }\r\n\r\n  if (step === 9) {\r\n    return {\r\n      x: 50 + (step - 2) * space,\r\n      y: 200\r\n    }\r\n  }\r\n  if (step >= 9) {\r\n    return {\r\n      x: 50 + (step - 2) * space,\r\n      y: 300\r\n    }\r\n  }\r\n  return {\r\n    x: 50 + (step - 1) * space,\r\n    y: 300\r\n  }\r\n};\r\n\r\nexport type ProcessStep = \"deployment_mobilization_phase\"\r\n  | \"individual_application_stage\"\r\n  | \"policies_for_all_grades\"\r\n  | \"first_self_assessment\"\r\n  | \"first_class_announcement\"\r\n  | \"second_personal_self_assessment\"\r\n  | \"second_class_announcement\"\r\n  | \"grade_announcement\"\r\n  | \"examination_and_review_of_the_discipline_office\"\r\n  | \"verification_and_deliberation_by_the_scholarship_evaluation_group\"\r\n  | \"school_review_stage\"\r\n  | \"finish\";\r\n\r\n/**步骤状态：未开始、进行中、已结束、回溯中 */\r\nexport type StepStatus = \"not_start\" | \"in_progress\" | \"completed\" | \"backtracking\" | \"error\";\r\n\r\nexport const StepStatusInfo = {\r\n  not_start: {\r\n    color: \"#fafafa\",\r\n    text: \"未开始\",\r\n    border: \"#d9d9d9\"\r\n  },\r\n  in_progress: {\r\n    color: \"#e6f7ff\",\r\n    text: \"进行中\",\r\n    border: \"#91d5ff\"\r\n  },\r\n  completed: {\r\n    color: \"#f6ffed\",\r\n    text: \"已完成\",\r\n    border: \"#b7eb8f\",\r\n  },\r\n  backtracking: {\r\n    color: \"#fffbe6\",\r\n    text: \"回溯中（问题处理）\",\r\n    border: \"#ffe58f\"\r\n  },\r\n  error: {\r\n    color: \"#fff2f0\",\r\n    text: \"流程异常\",\r\n    border: \"#ffccc7\",\r\n  }\r\n}\r\n\r\nexport type ProcessItem = {\r\n  x: number;\r\n  y: number;\r\n  step: number;\r\n  title: string;\r\n  name: ProcessStep;\r\n  responsible_department: string[];\r\n  desc: string;\r\n  duration: number;\r\n  date: [string, string];\r\n  status: StepStatus;\r\n  itemStyle: any;\r\n}\r\n\r\nconst getStepStatus = (date: [string, string], abnormalStatus?: \"error\" | \"backtracking\") => {\r\n  const [start, end] = date;\r\n  let status: StepStatus = 'not_start';\r\n  if ([\"error\", \"backtracking\"].includes(abnormalStatus || '')) {\r\n    status = abnormalStatus as StepStatus;\r\n  } else if (moment().isBetween(start, end)) {\r\n    status = 'in_progress';\r\n  } else if (moment().isBefore(start)) {\r\n    status = 'not_start';\r\n  } else if (moment().isAfter(end)) {\r\n    status = 'completed';\r\n  }\r\n  return status;\r\n}\r\n\r\nconst getLabelStyle = (status: StepStatus) => {\r\n  return {\r\n    color: StepStatusInfo[status].color,\r\n    borderColor: StepStatusInfo[status].border\r\n  }\r\n}\r\n\r\nexport const CurrentDate: [string, string] = [moment('2011-1-01').format('YYYY-MM-DD'), moment().add(1, \"days\").format('YYYY-MM-DD')]\r\n\r\nexport const ProcessList:Omit<ProcessItem,\"date\" | \"status\" | \"itemStyle\">[] = [\r\n  {\r\n    step: 1,\r\n    title: \"部署动员阶段\",\r\n    name: \"deployment_mobilization_phase\",\r\n    responsible_department: [\"学科办\", \"学工办\"],\r\n    desc: \"学院研究生奖助学金评审组审议通过学业奖学金评选细则，下发评选文件，通知符合条件的研究生参加评选。\",\r\n    duration: 4,\r\n    ...getPosition(1)\r\n  },\r\n  {\r\n    step: 2,\r\n    title: \"个人申请阶段\",\r\n    name: \"individual_application_stage\",\r\n    responsible_department: [\"研究生\"],\r\n    desc: \"由本人依照评选条件向学院提交书面申请。\",\r\n    duration: 3,\r\n    ...getPosition(2)\r\n  },\r\n  {\r\n    step: 3,\r\n    title: \"各年级政策宣讲\",\r\n    name: \"policies_for_all_grades\",\r\n    responsible_department: [\"学科办\"],\r\n    desc: \"讲解学业奖学金评选细则，指导研究生计算本人总分。\",\r\n    duration: 1,\r\n    ...getPosition(3)\r\n  },\r\n  {\r\n    step: 4,\r\n    title: \"第一次个人自评\",\r\n    name: \"first_self_assessment\",\r\n    responsible_department: [\"研究生\"],\r\n    desc: \"学生本人填写《计算机学院研究生学业奖学金量化得分表》，提交电子版及打印签字版。提交班长。\",\r\n    duration: 2,\r\n    ...getPosition(4)\r\n  },\r\n  {\r\n    step: 5,\r\n    title: \"第一次班级公示\",\r\n    name: \"first_class_announcement\",\r\n    responsible_department: [\"班长\"],\r\n    desc: \"班级内公示每位同学的量化得分表。班长核对本班每位同学申报材料，核对分数；并根据其它同学的反映核实相关材料及互评分数。\",\r\n    duration: 2,\r\n    ...getPosition(5)\r\n  },\r\n  {\r\n    step: 6,\r\n    title: \"第二次个人自评\",\r\n    name: \"second_personal_self_assessment\",\r\n    responsible_department: [\"研究生\"],\r\n    desc: \"第一次公示有错误的学生本人重新填写《计算机学院研究生学业奖学金量化得分表》， 提交电子版及打印签字版。提交班长。\",\r\n    duration: 1,\r\n    ...getPosition(6)\r\n  },\r\n  {\r\n    step: 7,\r\n    title: \"第二次班级公示\",\r\n    name: \"second_class_announcement\",\r\n    responsible_department: [\"班长\"],\r\n    desc: \"班级内公示每位同学的量化得分表，班长核对本班每位同学分数，并请同学在汇总表签字确认。\",\r\n    duration: 2,\r\n    ...getPosition(7)\r\n  },\r\n  {\r\n    step: 8,\r\n    title: \"年级公示\",\r\n    name: \"grade_announcement\",\r\n    responsible_department: [\"辅导员\"],\r\n    desc: \"在年级中公示学业奖学金排名及公示本年级每位同学的量化得分表，年级负责人根据同学的反映核实互评分数（修改分数需重新确认签字计分表）。汇总材料上报学科办。\",\r\n    duration: 2,\r\n    ...getPosition(8),\r\n  },\r\n  {\r\n    step: 9,\r\n    title: \"学科办审核、复查\",\r\n    name: \"examination_and_review_of_the_discipline_office\",\r\n    responsible_department: [\"学科办\"],\r\n    desc: \"学科办复查申报相关材料、公布各年级计分结果。\",\r\n    duration: 2,\r\n    ...getPosition(9)\r\n  },\r\n  {\r\n    step: 10,\r\n    title: \"奖学金评定小组核查、审议\",\r\n    name: \"verification_and_deliberation_by_the_scholarship_evaluation_group\",\r\n    responsible_department: [\"各学院\"],\r\n    desc: \"学院评审委员会按学科、专业比例等要求，提出评审意见和推荐名单，并将结果按要求在学院公告栏、网站等进行公示5日。公示结束后，按要求将相关材料于交到研究生工作办公室。\",\r\n    duration: 3,\r\n    ...getPosition(10)\r\n  },\r\n  {\r\n    step: 11,\r\n    title: \"学校评审阶段\",\r\n    name: \"school_review_stage\",\r\n    responsible_department: [\"研究生院\"],\r\n    desc: \"由研究生院提请校研究生学业奖学金评审领导小组进行最后评审，并确定候选人名单。\",\r\n    duration: -1,\r\n    ...getPosition(11)\r\n  },\r\n  {\r\n    step: 12,\r\n    title: \"结束\",\r\n    name: \"finish\",\r\n    responsible_department: [\"研究生院\"],\r\n    desc: \"结束研究生奖学金评选\",\r\n    duration: -1,\r\n    ...getPosition(12)\r\n  }\r\n];\r\nexport const getProcessList = (statusInfo?: Record<ProcessStep, { date: [string, string]; status?: StepStatus; }>): ProcessItem[] => {\r\n\r\n  const defaultInfo: {\r\n    status: StepStatus;\r\n    date: [string, string];\r\n  } = {\r\n    status: 'not_start',\r\n    date: CurrentDate\r\n  };\r\n  return ProcessList.map(item => {\r\n    const info = statusInfo ? (statusInfo[item.name as ProcessStep] || defaultInfo) : defaultInfo;\r\n    const status = getStepStatus(info?.date, info?.status as any);\r\n    return {\r\n      ...item,\r\n      itemStyle: getLabelStyle(status),\r\n      date: info.date,\r\n      status: info.status,\r\n    }\r\n  }) as ProcessItem[]\r\n};\r\n\r\nexport const LinksProcessList: {\r\n  target: ProcessStep;\r\n  source: ProcessStep;\r\n}[] = [\r\n    {\r\n      source: 'deployment_mobilization_phase',\r\n      target: 'individual_application_stage'\r\n    },\r\n    {\r\n      source: 'individual_application_stage',\r\n      target: 'policies_for_all_grades'\r\n    },\r\n    {\r\n      source: 'policies_for_all_grades',\r\n      target: 'first_self_assessment'\r\n    },\r\n    {\r\n      source: 'first_self_assessment',\r\n      target: 'first_class_announcement'\r\n    },\r\n    {\r\n      source: 'first_class_announcement',\r\n      target: 'second_personal_self_assessment'\r\n    },\r\n    {\r\n      source: 'second_personal_self_assessment',\r\n      target: 'second_class_announcement'\r\n    },\r\n    {\r\n      source: 'second_class_announcement',\r\n      target: 'grade_announcement'\r\n    },\r\n    {\r\n      source: 'second_class_announcement',\r\n      target: 'examination_and_review_of_the_discipline_office',\r\n    },\r\n    {\r\n      source: 'grade_announcement',\r\n      target: 'verification_and_deliberation_by_the_scholarship_evaluation_group'\r\n    },\r\n    {\r\n      source: 'examination_and_review_of_the_discipline_office',\r\n      target: 'verification_and_deliberation_by_the_scholarship_evaluation_group'\r\n    },\r\n    {\r\n      source: 'verification_and_deliberation_by_the_scholarship_evaluation_group',\r\n      target: 'school_review_stage'\r\n    },\r\n    {\r\n      source: 'school_review_stage',\r\n      target: 'finish'\r\n    }\r\n  ];","import * as React from 'react';\r\nimport ReactECharts from 'echarts-for-react';\r\nimport { Card } from 'antd';\r\nimport { LinksProcessList, ProcessItem, getProcessList, ProcessStep, StepStatusInfo } from '../../process.list';\r\nimport style from '../../style.module.less';\r\n\r\ninterface IProps {\r\n  currentStep: ProcessStep;\r\n  title: string;\r\n}\r\n\r\n/**\r\n * 渲染tooltip模板\r\n */\r\nconst renderToolTipHtml = (data: ProcessItem) => {\r\n  const tagStyle = [\r\n    {\r\n      color: \"#08979c\",\r\n      background: \"#e6fffb\",\r\n      borderColor: \"#87e8de\",\r\n    },\r\n    {\r\n      color: \"#096dd9\",\r\n      background: \"#e6f7ff\",\r\n      borderColor: \"#91d5ff\"\r\n    },\r\n    {\r\n      color: \"#531dab\",\r\n      background: \"#f9f0ff\",\r\n      borderColor: \"#d3adf7\",\r\n    }\r\n  ];\r\n  return `\r\n    <div style=\"width: 320px;\">\r\n      <div style=\"display:flex;\">\r\n        <h4 style=\"font-weight: 600;\">${data.title}</h4>\r\n        <h5\r\n        style=\"box-shadow:1px 1px 4px #aaa;font-weight: 550;background: ${StepStatusInfo[data.status].color};border: 1px solid ${StepStatusInfo[data.status].border};padding: 0px 4px;margin-left: 8px;border-radius: 2px;\"\r\n        >${StepStatusInfo[data.status].text}</h5>\r\n      </div>\r\n      <div style=\"display: flex;justify-content: space-between;border-bottom: 1px solid #aaa;padding-bottom: 8px;margin: 4px 0;\">\r\n        <span>时间：${data.date[0]}~${data.date[1]}</span>\r\n        <ul style=\"list-style: none;display: flex;\">\r\n          ${data.responsible_department.map((item, index) => `\r\n            <li\r\n              style=\"margin: 0 4px;background: ${tagStyle[index % 3].background};color: ${tagStyle[index % 3].color};border-radius: 2px;box-shadow:1px 1px 4px #ccc;border: 1px solid ${tagStyle[index % 3].borderColor};width: fit-content;padding: 0px 4px;\"\r\n              key=\"${item}-${index}\"\r\n            >\r\n              ${item}\r\n            </li>\r\n          `).join('\\n')\r\n    }\r\n        </ul>\r\n      </div>\r\n      <p style=\"width: 100%;white-space: normal;\">${data.desc}</p>   \r\n    </div>\r\n  `;\r\n}\r\n\r\n\r\nexport const ApplyProcessCharts: React.FC<IProps> = (props) => {\r\n  const { title } = props;\r\n  const processList = React.useMemo(() => getProcessList(), []);\r\n  const chartOptions = React.useMemo(() => ({\r\n    title: {\r\n      text: title,\r\n    },\r\n    tooltip: {\r\n      formatter: (params: any) => {\r\n        const { data } = params;\r\n        return renderToolTipHtml(data);\r\n      }\r\n    },\r\n    animationDurationUpdate: 1500,\r\n    animationEasingUpdate: 'quinticInOut',\r\n    series: [\r\n      {\r\n        type: 'graph',\r\n        layout: 'none',\r\n        symbolSize: 64,\r\n        label: {\r\n          show: true,\r\n          overflow: 'breakAll',\r\n          width: 56,\r\n          formatter: (params: any) => {\r\n            return params.data.title;\r\n          }\r\n        },\r\n        edgeSymbol: ['circle', 'arrow'],\r\n        edgeSymbolSize: [4, 10],\r\n        edgeLabel: {\r\n          fontSize: 20\r\n        },\r\n        data: processList,\r\n        links: LinksProcessList,\r\n        lineStyle: {\r\n          opacity: 0.9,\r\n          width: 2,\r\n          curveness: 0\r\n        }\r\n      }\r\n    ]\r\n  }), [processList, LinksProcessList]);\r\n  return (\r\n    <ReactECharts\r\n      option={chartOptions}\r\n    >\r\n    </ReactECharts>\r\n  );\r\n}\r\n\r\nconst ApplyProcessSteps: React.FC<IProps> = (props) => {\r\n  return (\r\n    <Card\r\n      className={style['process-step-card']}\r\n    >\r\n      <ApplyProcessCharts {...props} />\r\n    </Card>\r\n  );\r\n};\r\n\r\nApplyProcessSteps.defaultProps = {\r\n  currentStep: 'deployment_mobilization_phase'\r\n}\r\n\r\nexport default ApplyProcessSteps;"],"names":["React.useMemo","ReactECharts"],"mappings":"4gBAKA,KAAM,GAAc,AAAC,GAAiB,MAC9B,GAAQ,UACV,KAAS,EACJ,CACL,EAAG,MAAa,GAAK,EACrB,EAAG,KAIH,IAAS,EACJ,CACL,EAAG,MAAa,GAAK,EACrB,EAAG,KAGH,GAAQ,EACH,CACL,EAAG,MAAa,GAAK,EACrB,EAAG,KAGA,CACL,EAAG,MAAa,GAAK,EACrB,EAAG,MAoBM,EAAiB,CAC5B,UAAW,CACT,MAAO,UACP,KAAM,qBACN,OAAQ,WAEV,YAAa,CACX,MAAO,UACP,KAAM,qBACN,OAAQ,WAEV,UAAW,CACT,MAAO,UACP,KAAM,qBACN,OAAQ,WAEV,aAAc,CACZ,MAAO,UACP,KAAM,yDACN,OAAQ,WAEV,MAAO,CACL,MAAO,UACP,KAAM,2BACN,OAAQ,YAkBN,EAAgB,CAAC,EAAwB,IAA8C,MACrF,CAAC,EAAO,GAAO,KACjB,GAAqB,kBACrB,CAAC,QAAS,gBAAgB,SAAS,GAAkB,MAC9C,EACA,IAAS,UAAU,EAAO,KAC1B,cACA,IAAS,SAAS,KAClB,YACA,IAAS,QAAQ,OACjB,aAEJ,GAGH,EAAgB,AAAC,GACd,EACL,MAAO,EAAe,GAAQ,MAC9B,YAAa,EAAe,GAAQ,SAI3B,EAAgC,CAAC,EAAO,aAAa,OAAO,cAAe,IAAS,IAAI,EAAG,QAAQ,OAAO,eAE1G,EAAkE,CAC7E,GACE,KAAM,EACN,MAAO,uCACP,KAAM,gCACN,uBAAwB,CAAC,qBAAO,sBAChC,KAAM,mSACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,uCACP,KAAM,+BACN,uBAAwB,CAAC,sBACzB,KAAM,qHACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,6CACP,KAAM,0BACN,uBAAwB,CAAC,sBACzB,KAAM,mJACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,6CACP,KAAM,wBACN,uBAAwB,CAAC,sBACzB,KAAM,2QACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,6CACP,KAAM,2BACN,uBAAwB,CAAC,gBACzB,KAAM,+VACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,6CACP,KAAM,kCACN,uBAAwB,CAAC,sBACzB,KAAM,8UACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,6CACP,KAAM,4BACN,uBAAwB,CAAC,gBACzB,KAAM,+PACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,2BACP,KAAM,qBACN,uBAAwB,CAAC,sBACzB,KAAM,qcACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,EACN,MAAO,mDACP,KAAM,kDACN,uBAAwB,CAAC,sBACzB,KAAM,uIACN,SAAU,GACP,EAAY,IAEjB,GACE,KAAM,GACN,MAAO,2EACP,KAAM,oEACN,uBAAwB,CAAC,sBACzB,KAAM,oeACN,SAAU,GACP,EAAY,KAEjB,GACE,KAAM,GACN,MAAO,uCACP,KAAM,sBACN,uBAAwB,CAAC,4BACzB,KAAM,uOACN,SAAU,IACP,EAAY,KAEjB,GACE,KAAM,GACN,MAAO,eACP,KAAM,SACN,uBAAwB,CAAC,4BACzB,KAAM,+DACN,SAAU,IACP,EAAY,MAGN,EAAiB,AAAC,GAAsG,MAE7H,GAGF,CACF,OAAQ,YACR,KAAM,SAED,GAAY,IAAI,GAAQ,MACvB,GAAO,GAAc,EAAW,EAAK,OAAwB,EAC7D,EAAS,EAAc,iBAAM,KAAM,iBAAM,cACxC,QACF,GADE,CAEL,UAAW,EAAc,GACzB,KAAM,EAAK,KACX,OAAQ,EAAK,YAKN,EAGP,CACF,CACE,OAAQ,gCACR,OAAQ,gCAEV,CACE,OAAQ,+BACR,OAAQ,2BAEV,CACE,OAAQ,0BACR,OAAQ,yBAEV,CACE,OAAQ,wBACR,OAAQ,4BAEV,CACE,OAAQ,2BACR,OAAQ,mCAEV,CACE,OAAQ,kCACR,OAAQ,6BAEV,CACE,OAAQ,4BACR,OAAQ,sBAEV,CACE,OAAQ,4BACR,OAAQ,mDAEV,CACE,OAAQ,qBACR,OAAQ,qEAEV,CACE,OAAQ,kDACR,OAAQ,qEAEV,CACE,OAAQ,oEACR,OAAQ,uBAEV,CACE,OAAQ,sBACR,OAAQ,qRCzRd,KAAM,GAAoB,AAAC,GAAsB,MACzC,GAAW,CACf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,WAEf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,WAEf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,kBAGV;AAAA;AAAA;AAAA,wCAG+B,EAAK;AAAA;AAAA,0EAE6B,EAAe,EAAK,QAAQ,2BAA2B,EAAe,EAAK,QAAQ;AAAA,WAClJ,EAAe,EAAK,QAAQ;AAAA;AAAA;AAAA,kCAGpB,EAAK,KAAK,MAAM,EAAK,KAAK;AAAA;AAAA,YAEjC,EAAK,uBAAuB,IAAI,CAAC,EAAM,IAAU;AAAA;AAAA,iDAEZ,EAAS,EAAQ,GAAG,qBAAqB,EAAS,EAAQ,GAAG,0EAA0E,EAAS,EAAQ,GAAG;AAAA,qBACvL,KAAQ;AAAA;AAAA,gBAEb;AAAA;AAAA,aAEH,KAAK;AAAA;AAAA;AAAA;AAAA,oDAIkC,EAAK;AAAA;AAAA,KAM5C,EAAuC,AAAC,GAAU,MACvD,CAAE,SAAU,EACZ,EAAcA,kBAAc,IAAM,IAAkB,IACpD,EAAeA,kBAAc,MACjC,MAAO,CACL,KAAM,GAER,QAAS,CACP,UAAW,AAAC,GAAgB,MACpB,CAAE,QAAS,QACV,GAAkB,KAG7B,wBAAyB,KACzB,sBAAuB,eACvB,OAAQ,CACN,CACE,KAAM,QACN,OAAQ,OACR,WAAY,GACZ,MAAO,CACL,KAAM,GACN,SAAU,WACV,MAAO,GACP,UAAW,AAAC,GACH,EAAO,KAAK,OAGvB,WAAY,CAAC,SAAU,SACvB,eAAgB,CAAC,EAAG,IACpB,UAAW,CACT,SAAU,IAEZ,KAAM,EACN,MAAO,EACP,UAAW,CACT,QAAS,GACT,MAAO,EACP,UAAW,OAIf,CAAC,EAAa,mCAEfC,EAAD,CACE,OAAQ,KAMR,EAAsC,AAAC,2BAExC,EAAD,CACE,UAAW,EAAM,8CAEhB,EAAD,KAAwB,KAK9B,EAAkB,aAAe,CAC/B,YAAa"}