{"version":3,"file":"index-79078c09.js","sources":["../../../src/pages/application/pages/application-list/components/history-line/index.tsx","../../../src/pages/application/pages/application-list/components/history-table/interface.ts","../../../src/pages/application/pages/application-list/components/history-table/index.tsx","../../../src/pages/application/pages/application-list/index.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, Empty, Timeline } from 'antd';\r\nimport Style from '../../style.module.less';\r\n\r\ninterface ITimeLine {\r\n  time: number;\r\n  info: string;\r\n}\r\n\r\nconst HistoryLine: React.FC = () => {\r\n  const [timeLines, setTimeLines] = React.useState<ITimeLine[]>([]);\r\n  return (\r\n    <Card>\r\n      {\r\n        !timeLines.length ? (\r\n          <Empty />\r\n        ) : (\r\n            <Timeline mode=\"left\">\r\n              {\r\n                timeLines.map(item => {\r\n                  return (\r\n                    <Timeline.Item\r\n                      key={item.time}\r\n                      label={item.time}\r\n                    >{item.info}</Timeline.Item>\r\n                  );\r\n                })\r\n              }\r\n            </Timeline>\r\n          )\r\n      }\r\n    </Card>\r\n  );\r\n}\r\nexport default HistoryLine;","export type IHandleStatus = 'save' | 'submit';\r\nexport type IValidateStatus = 'success' | 'failed';\r\nimport * as api from '@/service/apply';\r\n\r\n/** 历史 Columns */\r\nexport interface HistoryTableData {\r\n  handle_state: IHandleStatus;\r\n  create_at: string;\r\n  edit_at: string;\r\n  id: number;\r\n  score_info: api.ScoreValue;\r\n  score: number;\r\n  editable: boolean;\r\n  user_id: string;\r\n}\r\n\r\nexport const TypesMap: Map<IValidateStatus | IHandleStatus, string> = new Map([\r\n  ['save', '已保存'],\r\n  ['submit', '已提交'],\r\n  ['success', '已验证'],\r\n  ['failed', '未验证']\r\n])","import * as React from 'react';\r\nimport { Table, Tag, TableProps, Button, message, Drawer } from 'antd';\r\nimport * as I from './interface';\r\nimport { EditTwoTone } from '@ant-design/icons';\r\nimport * as api from '@/service/apply';\r\nimport { useProcess } from '@/context/process-status';\r\nimport ApplicationForm from '@/pages/application/pages/application-form';\r\nimport ScoreForm from './score-form';\r\nimport { Link } from 'react-router-dom';\r\nimport { useAuth } from '@/context/auth.context';\r\n\r\nconst getColumns = (\r\n  identity: IUser['identity'],\r\n  changeEditForm: (id: number) => void\r\n): TableProps<I.HistoryTableData>['columns'] => [\r\n    {\r\n      title: '表单ID',\r\n      dataIndex: 'id',\r\n      key: 'id',\r\n    },\r\n    {\r\n      title: '当前状态',\r\n      dataIndex: 'handle_state',\r\n      key: 'handle_state',\r\n      render: (state: I.IHandleStatus) => <Tag color={state === 'submit' ? 'success' : 'geekblue'}>{I.TypesMap.get(state)}</Tag>\r\n    },\r\n    {\r\n      title: '学号',\r\n      dataIndex: 'user_id',\r\n      key: 'user_id',\r\n    },\r\n    {\r\n      title: '得分',\r\n      dataIndex: 'score',\r\n      key: 'score',\r\n    },\r\n    {\r\n      title: '最近评审人工号',\r\n      dataIndex: 'comment_user',\r\n      key: 'comment_user',\r\n    },\r\n    {\r\n      title: '创建时间',\r\n      key: 'create_at',\r\n      dataIndex: 'create_at'\r\n    },\r\n    {\r\n      title: '更新时间',\r\n      key: 'edit_at',\r\n      dataIndex: 'edit_at',\r\n    },\r\n    {\r\n      title: '操作',\r\n      key: 'action',\r\n      render: (_, record) => (\r\n        record.editable && identity !== 'manager' ? (\r\n          <Link to={`/apply/form/${record.id}`} state={{\r\n            showScore: true,\r\n          }}>\r\n            <Button\r\n              shape=\"round\"\r\n              icon={<EditTwoTone />}\r\n            >\r\n              修改评分\r\n          </Button>\r\n          </Link >\r\n        ) : (\r\n            <Button\r\n              type=\"dashed\"\r\n              shape=\"round\"\r\n              onClick={() => changeEditForm(record.id)}\r\n              icon={<EditTwoTone />}\r\n            >审核</Button>\r\n          )\r\n      ),\r\n    },\r\n  ];\r\n\r\n\r\nconst HistoryTable: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [tableData, setTableData] = React.useState<I.HistoryTableData[]>([]);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [visible, setVisible] = React.useState(false);\r\n  const [selectedId, setSelectedId] = React.useState(-1);\r\n  const { process_id } = useProcess();\r\n\r\n  const commentApplyForm = (id: number) => {\r\n    setVisible(true);\r\n    setSelectedId(id)\r\n  }\r\n\r\n  const onCloseForm = () => {\r\n    setVisible(false);\r\n    setSelectedId(-1);\r\n  };\r\n\r\n  const columns = React.useMemo(() => getColumns(user.identity, commentApplyForm), [user.identity, commentApplyForm])\r\n\r\n  const getTableData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const applyList = await api.getApplicationList({\r\n        page_count: 10,\r\n        page_index: 1,\r\n        is_check: user.identity,\r\n        procedure_id: process_id\r\n      });\r\n      const tableData: I.HistoryTableData[] = (applyList || []).map(item => ({\r\n        key: item.id,\r\n        id: item.id,\r\n        create_at: item.create_at,\r\n        edit_at: item.edit_at,\r\n        handle_state: item.status,\r\n        score_info: item.score_info,\r\n        score: item.score,\r\n        user_id: item.user_id,\r\n        comment_user: item.step.user_id,\r\n        editable: item.editable,\r\n      }));\r\n      setTableData(tableData);\r\n    } catch (error) {\r\n      console.log(error);\r\n      message.error(\"获取申请列表失败\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  const selectedInfo = React.useMemo(() => tableData.find(item => item.id === selectedId), [tableData, selectedId]);\r\n\r\n\r\n  React.useEffect(() => {\r\n    getTableData();\r\n  }, []);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Drawer\r\n        onClose={onCloseForm}\r\n        visible={visible}\r\n        width={992}\r\n        headerStyle={{\r\n          height: 48,\r\n          padding: 20\r\n        }}\r\n        bodyStyle={{\r\n          padding: '16px 8px'\r\n        }}\r\n        footer={\r\n          <ScoreForm applyId={selectedId} initValue={selectedInfo?.score_info} />\r\n        }\r\n        footerStyle={{\r\n          height: 80,\r\n        }}\r\n      >\r\n        <ApplicationForm commentApplyId={selectedId} />\r\n      </Drawer>\r\n      <Table\r\n        loading={loading}\r\n        columns={columns}\r\n        dataSource={tableData}\r\n      />\r\n    </React.Fragment>\r\n  )\r\n};\r\n\r\nexport default HistoryTable;","import { Col, Row, Space } from 'antd';\r\nimport * as React from 'react';\r\nimport HistoryLine from './components/history-line';\r\nimport HistoryTable from './components/history-table';\r\n\r\nconst ApplicationList: React.FC = () => {\r\n  return (\r\n    <React.Fragment>\r\n      <HistoryLine />\r\n      <HistoryTable />\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default ApplicationList;"],"names":["React.useState","I.TypesMap","React.useMemo","api.getApplicationList","React.Fragment"],"mappings":"yUASA,KAAM,GAAwB,IAAM,MAC5B,CAAC,EAAW,GAAgBA,mBAA4B,mCAE3D,EAAD,KAEI,AAAC,EAAU,+BAGN,EAAD,CAAU,KAAK,QAEX,EAAU,IAAI,2BAET,EAAS,KAAV,CACE,IAAK,EAAK,KACV,MAAO,EAAK,MACZ,EAAK,gCAThB,EAAD,QCCG,EAAyD,GAAI,KAAI,CAC5E,CAAC,OAAQ,sBACT,CAAC,SAAU,sBACX,CAAC,UAAW,sBACZ,CAAC,SAAU,wBCTP,EAAa,CACjB,EACA,IAC8C,CAC5C,CACE,MAAO,iBACP,UAAW,KACX,IAAK,MAEP,CACE,MAAO,2BACP,UAAW,eACX,IAAK,eACL,OAAQ,AAAC,2BAA4B,EAAD,CAAK,MAAO,IAAU,SAAW,UAAY,YAAaC,EAAW,IAAI,KAE/G,CACE,MAAO,eACP,UAAW,UACX,IAAK,WAEP,CACE,MAAO,eACP,UAAW,QACX,IAAK,SAEP,CACE,MAAO,6CACP,UAAW,eACX,IAAK,gBAEP,CACE,MAAO,2BACP,IAAK,YACL,UAAW,aAEb,CACE,MAAO,2BACP,IAAK,UACL,UAAW,WAEb,CACE,MAAO,eACP,IAAK,SACL,OAAQ,CAAC,EAAG,IACV,EAAO,UAAY,IAAa,kCAC7B,EAAD,CAAM,GAAI,eAAe,EAAO,KAAM,MAAO,CAC3C,UAAW,6BAEV,EAAD,CACE,MAAM,QACN,6BAAO,EAAD,OACP,qDAKA,EAAD,CACE,KAAK,SACL,MAAM,QACN,QAAS,IAAM,EAAe,EAAO,IACrC,6BAAO,EAAD,OACP,kBAOP,EAAyB,IAAM,MAC7B,CAAE,QAAS,IACX,CAAC,EAAW,GAAgBD,mBAAqC,IACjE,CAAC,EAAS,GAAcA,mBAAe,IACvC,CAAC,EAAS,GAAcA,mBAAe,IACvC,CAAC,EAAY,GAAiBA,mBAAe,IAC7C,CAAE,cAAe,IAEjB,EAAmB,AAAC,GAAe,GAC5B,MACG,IAGV,EAAc,IAAM,GACb,MACG,KAGV,EAAUE,kBAAc,IAAM,EAAW,EAAK,SAAU,GAAmB,CAAC,EAAK,SAAU,IAE3F,EAAe,SAAY,IAC3B,GACS,SAOL,IANY,KAAMC,GAAuB,CAC7C,WAAY,GACZ,WAAY,EACZ,SAAU,EAAK,SACf,aAAc,KAEsC,IAAI,IAAI,KAC5D,IAAK,EAAK,GACV,GAAI,EAAK,GACT,UAAW,EAAK,UAChB,QAAS,EAAK,QACd,aAAc,EAAK,OACnB,WAAY,EAAK,WACjB,MAAO,EAAK,MACZ,QAAS,EAAK,QACd,aAAc,EAAK,KAAK,QACxB,SAAU,EAAK,cAEJ,SACN,WACC,IAAI,KACJ,MAAM,8DAEH,MAIT,EAAeD,kBAAc,IAAM,EAAU,KAAK,GAAQ,EAAK,KAAO,GAAa,CAAC,EAAW,+BAGrF,IAAM,MAEnB,4BAGAE,mBAAD,6BACG,EAAD,CACE,QAAS,EACT,UACA,MAAO,IACP,YAAa,CACX,OAAQ,GACR,QAAS,IAEX,UAAW,CACT,QAAS,YAEX,+BACG,EAAD,CAAW,QAAS,EAAY,UAAW,iBAAc,aAE3D,YAAa,CACX,OAAQ,6BAGT,EAAD,CAAiB,eAAgB,6BAElC,EAAD,CACE,UACA,UACA,WAAY,MC5Jd,EAA4B,4BAE7BA,mBAAD,6BACG,EAAD,8BACC,EAAD"}