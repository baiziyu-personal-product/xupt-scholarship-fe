{"version":3,"file":"index-b01b03d1.js","sources":["../../../src/components/page-nav/index.tsx","../../../src/components/footer/index.tsx","../../../src/pages/page-layout/page-header.tsx","../../../src/pages/page-layout/index.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { getMenus, getMatchedKeys, renderMenu, getTitle } from './menu.config';\r\nimport { Layout, Menu, MenuProps } from 'antd';\r\nimport { useLocation } from 'react-router-dom';\r\nimport * as hooks from '@/hooks'\r\nimport style from './style.module.less';\r\nimport { useAuth } from '@/context/auth.context';\r\nimport { useProcess } from '@/context/process-status';\r\n\r\n\r\ninterface IProps {\r\n  updateCrumbTitle: React.Dispatch<React.SetStateAction<string[]>>;\r\n}\r\n\r\nconst PageNav: React.FC<IProps> = (props) => {\r\n  const { updateCrumbTitle } = props;\r\n  const { pathname } = useLocation();\r\n  const { user } = useAuth();\r\n  const { process_id } = useProcess();\r\n  const menus = React.useMemo(() => getMenus(process_id), [process_id]);\r\n  const matchKeys = React.useMemo(() => getMatchedKeys(pathname, menus), [menus, pathname]);\r\n  const [selectKeys, setSelectedKeys] = React.useState<string[]>(!!matchKeys.length ? matchKeys : ['home']);\r\n  const titleList = React.useMemo(() => getTitle(selectKeys, menus), [menus, selectKeys,]);\r\n  hooks.useDocumentTitle(titleList.join('-'), [titleList]);\r\n  const NavMenu = React.useMemo(() => renderMenu(menus, user.identity), [menus, user.identity]);\r\n\r\n  const updateKeys: MenuProps['onClick'] = (e) => {\r\n    setSelectedKeys(e.keyPath)\r\n  }\r\n  // 避免初始化进入导致的页面导航不匹配\r\n  React.useEffect(() => {\r\n    if (matchKeys && matchKeys.join('/') !== selectKeys.join('/')) {\r\n      setSelectedKeys([...matchKeys]);\r\n    }\r\n  }, [matchKeys]);\r\n\r\n  React.useEffect(() => {\r\n    updateCrumbTitle(titleList);\r\n  }, [titleList]);\r\n\r\n  return (\r\n    <Layout.Sider\r\n      collapsible\r\n      theme=\"light\"\r\n      breakpoint=\"lg\"\r\n      className={style['sider-nav']}\r\n    >\r\n      <Menu\r\n        mode=\"inline\"\r\n        selectedKeys={selectKeys}\r\n        onClick={updateKeys}\r\n        theme=\"light\"\r\n        className={style['page-menu']}\r\n      >\r\n        {\r\n          NavMenu\r\n        }\r\n      </Menu>\r\n    </Layout.Sider>\r\n  )\r\n};\r\n\r\nexport default React.memo(PageNav);","import * as React from 'react';\r\nimport { Layout } from 'antd';\r\n\r\nimport style from \"./index.module.less\";\r\n\r\nconst Footer: React.FC = () => {\r\n  return (\r\n    <Layout.Footer\r\n      className={style['footer']}\r\n    >\r\n      版权所有© Copyright 2022 西安邮电大学 Xi'an University of Posts&Telecommunications\r\n    </Layout.Footer>\r\n  )\r\n};\r\n\r\nexport default Footer;","import { usePageHeaderContext } from '@/context/page-header';\r\nimport { Breadcrumb, PageHeader } from 'antd';\r\nimport style from './style.module.less';\r\nimport * as React from 'react';\r\nimport { cx } from '@/utils';\r\n\r\ninterface IProps {\r\n  crumbTitle: string[];\r\n}\r\n\r\nconst AuthPageHeader: React.FC<IProps> = (props) => {\r\n  const { crumbTitle } = props;\r\n  const { children, ...resetProps } = usePageHeaderContext();\r\n  return (\r\n    <PageHeader\r\n      className={\r\n        cx(\r\n          style['page-header'],\r\n          children ? '' : style['sticky-header']\r\n        )\r\n      }\r\n      breadcrumbRender={() => (\r\n        <Breadcrumb>\r\n          {\r\n            crumbTitle.map(item => (\r\n              <Breadcrumb.Item key={item}>{item}</Breadcrumb.Item>\r\n            ))\r\n          }\r\n        </Breadcrumb>\r\n      )}\r\n      {...resetProps}\r\n    >{children}</PageHeader>\r\n  );\r\n};\r\n\r\nexport default AuthPageHeader;","import * as React from 'react';\r\nimport { Outlet } from 'react-router-dom';\r\nimport { Layout, Modal } from 'antd';\r\nimport PageNav from '@/components/page-nav';\r\nimport Footer from '@/components/footer';\r\nimport Header from '@/components/header';\r\nimport UpdateUserInfo from '@/components/update-user-info';\r\nimport { PageHeaderProvider } from '@/context/page-header';\r\nimport PageHeader from './page-header';\r\nimport style from './style.module.less'\r\nimport { UserListProvider } from '@/context/user-list';\r\nimport { useAuth } from '@/context/auth.context';\r\n\r\nconst PageLayout = () => {\r\n  const [crumbTitle, setCrumbTitle] = React.useState<string[]>([]);\r\n  const { user } = useAuth();\r\n  const showModal = React.useMemo(() => [\r\n    !user.user_id,\r\n    !user.name,\r\n    !user.phone,\r\n    user.identity === 'student' && ((!user.student) || !(user.student as IStudentInfo).type)\r\n  ].some(v => v), [user]);\r\n  return (\r\n    <Layout className=\"base-layout\">\r\n      <Header />\r\n      <Modal\r\n        footer={null}\r\n        title=\"完善用户信息\"\r\n        visible={showModal}>\r\n        <UpdateUserInfo\r\n          formValue={user}\r\n        />\r\n      </Modal>\r\n      <Layout className=\"site-layout\">\r\n        <PageNav\r\n          updateCrumbTitle={setCrumbTitle}\r\n        />\r\n        <Layout>\r\n          <Layout.Content\r\n            className=\"layout-content\"\r\n          >\r\n            <PageHeaderProvider>\r\n              <UserListProvider>\r\n                <PageHeader\r\n                  crumbTitle={crumbTitle}\r\n                />\r\n                <div className={style['main-content-box']}>\r\n                  <Outlet />\r\n                </div>\r\n              </UserListProvider>\r\n            </PageHeaderProvider>\r\n          </Layout.Content>\r\n          <Footer />\r\n        </Layout>\r\n      </Layout>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default PageLayout;\r\n"],"names":["React.useMemo","React.useState","style","React.memo","PageNav","PageHeader"],"mappings":"sjCAcA,KAAM,GAA4B,AAAC,GAAU,MACrC,CAAE,oBAAqB,EACvB,CAAE,YAAa,IACf,CAAE,QAAS,IACX,CAAE,cAAe,IACjB,EAAQA,kBAAc,IAAM,EAAS,GAAa,CAAC,IACnD,EAAYA,kBAAc,IAAM,EAAe,EAAU,GAAQ,CAAC,EAAO,IACzE,CAAC,EAAY,GAAmBC,mBAAyB,AAAE,EAAU,OAAS,EAAY,CAAC,SAC3F,EAAYD,kBAAc,IAAM,EAAS,EAAY,GAAQ,CAAC,EAAO,MACpD,EAAU,KAAK,KAAM,CAAC,SACvC,GAAUA,kBAAc,IAAM,EAAW,EAAO,EAAK,UAAW,CAAC,EAAO,EAAK,WAE7E,EAAmC,AAAC,GAAM,GAC9B,EAAE,qCAGJ,IAAM,CAChB,GAAa,EAAU,KAAK,OAAS,EAAW,KAAK,QACvC,CAAC,GAAG,KAErB,CAAC,wBAEY,IAAM,GACH,IAChB,CAAC,4BAGD,EAAO,MAAR,CACE,YAAW,GACX,MAAM,QACN,WAAW,KACX,UAAWE,EAAM,sCAEhB,EAAD,CACE,KAAK,SACL,aAAc,EACd,QAAS,EACT,MAAM,QACN,UAAWA,EAAM,cAGf,KAOV,MAAeC,eAAW,kECzD1B,KAAM,GAAmB,4BAEpB,EAAO,OAAR,CACE,UAAWD,EAAM,QAClB,kUCCL,KAAM,GAAmC,AAAC,GAAU,MAC5C,CAAE,cAAe,EACa,MAA5B,aAA4B,EAAf,IAAe,EAAf,CAAb,4CAEL,EAAD,GACE,UACE,EACE,EAAM,eACN,EAAW,GAAK,EAAM,kBAG1B,iBAAkB,4BACf,EAAD,KAEI,EAAW,IAAI,2BACZ,EAAW,KAAZ,CAAiB,IAAK,GAAO,MAKjC,GACJ,IClBA,GAAa,IAAM,MACjB,CAAC,EAAY,GAAiBD,mBAAyB,IACvD,CAAE,QAAS,IACX,EAAYD,kBAAc,IAAM,CACpC,CAAC,EAAK,QACN,CAAC,EAAK,KACN,CAAC,EAAK,MACN,EAAK,WAAa,aAAgB,EAAK,SAAY,CAAE,EAAK,QAAyB,OACnF,KAAK,GAAK,GAAI,CAAC,mCAEd,EAAD,CAAQ,UAAU,uCACf,EAAD,8BACC,EAAD,CACE,OAAQ,KACR,MAAM,uCACN,QAAS,2BACR,EAAD,CACE,UAAW,6BAGd,EAAD,CAAQ,UAAU,uCACfI,EAAD,CACE,iBAAkB,4BAEnB,EAAD,6BACG,EAAO,QAAR,CACE,UAAU,0CAET,EAAD,6BACG,EAAD,6BACGC,EAAD,CACE,uCAED,MAAD,CAAK,UAAW,EAAM,6CACnB,EAAD,kCAKP,EAAD"}