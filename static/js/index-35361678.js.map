{"version":3,"file":"index-35361678.js","sources":["../../../src/pages/process/pages/handle-process/components/apply-process-steps/index.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport ReactECharts from 'echarts-for-react';\r\nimport { Card, message } from 'antd';\r\nimport { LinksProcessList, ProcessItem, getProcessList, ProcessStep, StepStatusInfo, IStatusInfo, StepStatus } from '../../process.list';\r\nimport style from '../../style.module.less';\r\nimport * as api from '@/service/process';\r\nimport { useProcess } from '@/context/process-status';\r\nimport moment from 'moment';\r\nimport { DATE_FORMAT_NORMAL } from '@/config/time';\r\n\r\ninterface IProps {\r\n  title: string;\r\n}\r\n\r\n/**\r\n * 渲染tooltip模板\r\n */\r\nconst renderToolTipHtml = (data: ProcessItem) => {\r\n  const tagStyle = [\r\n    {\r\n      color: \"#08979c\",\r\n      background: \"#e6fffb\",\r\n      borderColor: \"#87e8de\",\r\n    },\r\n    {\r\n      color: \"#096dd9\",\r\n      background: \"#e6f7ff\",\r\n      borderColor: \"#91d5ff\"\r\n    },\r\n    {\r\n      color: \"#531dab\",\r\n      background: \"#f9f0ff\",\r\n      borderColor: \"#d3adf7\",\r\n    }\r\n  ];\r\n  return `\r\n    <div style=\"width: 320px;\">\r\n      <div style=\"display:flex;\">\r\n        <h4 style=\"font-weight: 600;\">${data.title}</h4>\r\n        <h5\r\n        style=\"box-shadow:1px 1px 4px #aaa;font-weight: 550;background: ${StepStatusInfo[data.status]?.color};border: 1px solid ${StepStatusInfo[data.status]?.border};padding: 0px 4px;margin-left: 8px;border-radius: 2px;\"\r\n        >${StepStatusInfo[data.status].text}</h5>\r\n      </div>\r\n      <div style=\"display: flex;justify-content: space-between;border-bottom: 1px solid #aaa;padding-bottom: 8px;margin: 4px 0;\">\r\n        <span>时间：${data.date[0]}~${data.date[1]}</span>\r\n        <ul style=\"list-style: none;display: flex;\">\r\n          ${data.responsible_department.map((item, index) => `\r\n            <li\r\n              style=\"margin: 0 4px;background: ${tagStyle[index % 3].background};color: ${tagStyle[index % 3].color};border-radius: 2px;box-shadow:1px 1px 4px #ccc;border: 1px solid ${tagStyle[index % 3].borderColor};width: fit-content;padding: 0px 4px;\"\r\n              key=\"${item}-${index}\"\r\n            >\r\n              ${item}\r\n            </li>\r\n          `).join('\\n')\r\n    }\r\n        </ul>\r\n      </div>\r\n      <p style=\"width: 100%;white-space: normal;\">${data.desc}</p>   \r\n    </div>\r\n  `;\r\n}\r\n\r\n\r\nexport const ApplyProcessCharts: React.FC<IProps> = (props) => {\r\n  const { title } = props;\r\n  const { process_id } = useProcess();\r\n  const [status, setStatus] = React.useState<IStatusInfo>();\r\n  const processList = React.useMemo(() => getProcessList(status), [status]);\r\n\r\n  const chartOptions = React.useMemo(() => ({\r\n    title: {\r\n      text: title,\r\n    },\r\n    tooltip: {\r\n      formatter: (params: any) => {\r\n        const { data } = params;\r\n        return renderToolTipHtml(data);\r\n      }\r\n    },\r\n    animationDurationUpdate: 1500,\r\n    animationEasingUpdate: 'quinticInOut',\r\n    series: [\r\n      {\r\n        type: 'graph',\r\n        layout: 'none',\r\n        symbolSize: 64,\r\n        label: {\r\n          show: true,\r\n          overflow: 'breakAll',\r\n          width: 56,\r\n          formatter: (params: any) => {\r\n            return params.data.title;\r\n          }\r\n        },\r\n        edgeSymbol: ['circle', 'arrow'],\r\n        edgeSymbolSize: [4, 10],\r\n        edgeLabel: {\r\n          fontSize: 20\r\n        },\r\n        data: processList,\r\n        links: LinksProcessList,\r\n        lineStyle: {\r\n          opacity: 0.9,\r\n          width: 2,\r\n          curveness: 0\r\n        }\r\n      }\r\n    ]\r\n  }), [processList]);\r\n  const stepStatusNormal: StepStatus[] = [\"not_start\", \"in_progress\", \"completed\", \"backtracking\", \"error\"];\r\n  \r\n  const getProcess = async () => {\r\n    try {\r\n      const res = await api.getProcessData(process_id);\r\n      const process = res.form.form;\r\n      const statusInfo = process.reduce((p, c) => {\r\n        const [start, end] = c.date || [];\r\n        const date = [\r\n          moment(start, DATE_FORMAT_NORMAL),\r\n          moment(end, DATE_FORMAT_NORMAL)\r\n        ];\r\n        const flag = [date[0] > moment(), date[0] < moment() && date[1] > moment(), date[1] < moment()]\r\n        p[c.step] = {\r\n          date: c.date as [string, string],\r\n          status: stepStatusNormal[flag.indexOf(true)],\r\n        };\r\n        return p;\r\n      }, {} as IStatusInfo);\r\n      setStatus(statusInfo);\r\n    } catch (error) {\r\n      message.error(error.message)\r\n    } finally {\r\n\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    getProcess()\r\n  }, [process_id])\r\n\r\n  return (\r\n    <ReactECharts\r\n      option={chartOptions}\r\n    >\r\n    </ReactECharts>\r\n  );\r\n}\r\n\r\nconst ApplyProcessSteps: React.FC<IProps> = (props) => {\r\n  return (\r\n    <Card\r\n      className={style['process-step-card']}\r\n    >\r\n      <ApplyProcessCharts {...props} />\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default ApplyProcessSteps;"],"names":["React.useState","React.useMemo","api.getProcessData","ReactECharts"],"mappings":"mjBAiBA,KAAM,GAAoB,AAAC,GAAsB,cACzC,GAAW,CACf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,WAEf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,WAEf,CACE,MAAO,UACP,WAAY,UACZ,YAAa,kBAGV;AAAA;AAAA;AAAA,wCAG+B,EAAK;AAAA;AAAA,0EAE6B,KAAe,EAAK,UAApB,cAA6B,2BAA2B,KAAe,EAAK,UAApB,cAA6B;AAAA,WACpJ,EAAe,EAAK,QAAQ;AAAA;AAAA;AAAA,kCAGpB,EAAK,KAAK,MAAM,EAAK,KAAK;AAAA;AAAA,YAEjC,EAAK,uBAAuB,IAAI,CAAC,EAAM,IAAU;AAAA;AAAA,iDAEZ,EAAS,EAAQ,GAAG,qBAAqB,EAAS,EAAQ,GAAG,0EAA0E,EAAS,EAAQ,GAAG;AAAA,qBACvL,KAAQ;AAAA;AAAA,gBAEb;AAAA;AAAA,aAEH,KAAK;AAAA;AAAA;AAAA;AAAA,oDAIkC,EAAK;AAAA;AAAA,KAM5C,EAAuC,AAAC,GAAU,MACvD,CAAE,SAAU,EACZ,CAAE,cAAe,IACjB,CAAC,EAAQ,GAAaA,qBACtB,EAAcC,kBAAc,IAAM,EAAe,GAAS,CAAC,IAE3D,EAAeA,kBAAc,MACjC,MAAO,CACL,KAAM,GAER,QAAS,CACP,UAAW,AAAC,GAAgB,MACpB,CAAE,QAAS,QACV,GAAkB,KAG7B,wBAAyB,KACzB,sBAAuB,eACvB,OAAQ,CACN,CACE,KAAM,QACN,OAAQ,OACR,WAAY,GACZ,MAAO,CACL,KAAM,GACN,SAAU,WACV,MAAO,GACP,UAAW,AAAC,GACH,EAAO,KAAK,OAGvB,WAAY,CAAC,SAAU,SACvB,eAAgB,CAAC,EAAG,IACpB,UAAW,CACT,SAAU,IAEZ,KAAM,EACN,MAAO,EACP,UAAW,CACT,QAAS,GACT,MAAO,EACP,UAAW,OAIf,CAAC,IACC,EAAiC,CAAC,YAAa,cAAe,YAAa,eAAgB,SAE3F,EAAa,SAAY,IACzB,MAGI,GAAa,AADH,AADJ,MAAMC,GAAmB,IACjB,KAAK,KACE,OAAO,CAAC,EAAG,IAAM,MACpC,CAAC,EAAO,GAAO,EAAE,MAAQ,GACzB,EAAO,CACX,EAAO,EAAO,GACd,EAAO,EAAK,IAER,EAAO,CAAC,EAAK,GAAK,IAAU,EAAK,GAAK,KAAY,EAAK,GAAK,IAAU,EAAK,GAAK,cACpF,EAAE,MAAQ,CACV,KAAM,EAAE,KACR,OAAQ,EAAiB,EAAK,QAAQ,MAEjC,GACN,MACO,SACH,KACC,MAAM,EAAM,+CAMR,IAAM,MAEnB,CAAC,4BAGDC,EAAD,CACE,OAAQ,KAMR,EAAsC,AAAC,2BAExC,EAAD,CACE,UAAW,EAAM,8CAEhB,EAAD,KAAwB"}